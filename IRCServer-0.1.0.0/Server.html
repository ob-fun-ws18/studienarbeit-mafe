<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Server</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Server.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">IRCServer-0.1.0.0</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Server</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module contains functions for the handling of connections between client
and server.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:Event">Event</a><ul class="subs"><li>= <a href="#v:ClientMsg">ClientMsg</a> <a href="User.html#t:User" title="User">User</a> <a href="Client.html#t:Msg" title="Client">Msg</a></li><li>| <a href="#v:NewUser">NewUser</a> <a href="User.html#t:User" title="User">User</a> <a href="../base-4.11.1.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a></li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:Users">Users</a> = <a href="../containers-0.5.11.0/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="../base-4.11.1.0/Data-String.html#t:String" title="Data.String">String</a> <a href="../base-4.11.1.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:Channels">Channels</a> = <a href="../containers-0.5.11.0/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="../base-4.11.1.0/Data-String.html#t:String" title="Data.String">String</a> [<a href="../base-4.11.1.0/Data-String.html#t:String" title="Data.String">String</a>]</li><li class="src short"><a href="#v:startServer">startServer</a> :: PortNumber -&gt; <a href="../base-4.11.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:acceptConnections">acceptConnections</a> :: Socket -&gt; <a href="../base-4.11.1.0/Control-Concurrent-Chan.html#t:Chan" title="Control.Concurrent.Chan">Chan</a> <a href="Server.html#t:Event" title="Server">Event</a> -&gt; <a href="../base-4.11.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:mainServer">mainServer</a> :: <a href="../base-4.11.1.0/Control-Concurrent-Chan.html#t:Chan" title="Control.Concurrent.Chan">Chan</a> <a href="Server.html#t:Event" title="Server">Event</a> -&gt; <a href="Server.html#t:Users" title="Server">Users</a> -&gt; <a href="Server.html#t:Channels" title="Server">Channels</a> -&gt; <a href="../base-4.11.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:handleEvent">handleEvent</a> :: <a href="Server.html#t:Users" title="Server">Users</a> -&gt; <a href="Server.html#t:Channels" title="Server">Channels</a> -&gt; <a href="Server.html#t:Event" title="Server">Event</a> -&gt; <a href="../base-4.11.1.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Server.html#t:Users" title="Server">Users</a>, <a href="Server.html#t:Channels" title="Server">Channels</a>)</li><li class="src short"><a href="#v:sendToUser">sendToUser</a> :: <a href="Server.html#t:Users" title="Server">Users</a> -&gt; <a href="../base-4.11.1.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../base-4.11.1.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../base-4.11.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:sendToAllUsers">sendToAllUsers</a> :: <a href="Server.html#t:Users" title="Server">Users</a> -&gt; [<a href="../base-4.11.1.0/Data-String.html#t:String" title="Data.String">String</a>] -&gt; <a href="../base-4.11.1.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../base-4.11.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:startConn">startConn</a> :: (Socket, SockAddr) -&gt; <a href="../base-4.11.1.0/Control-Concurrent-Chan.html#t:Chan" title="Control.Concurrent.Chan">Chan</a> <a href="Server.html#t:Event" title="Server">Event</a> -&gt; <a href="../base-4.11.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:loopConn">loopConn</a> :: <a href="../base-4.11.1.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; <a href="../base-4.11.1.0/Control-Concurrent-Chan.html#t:Chan" title="Control.Concurrent.Chan">Chan</a> <a href="Server.html#t:Event" title="Server">Event</a> -&gt; <a href="User.html#t:User" title="User">User</a> -&gt; <a href="../base-4.11.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:isFinalMsg">isFinalMsg</a> :: <a href="Client.html#t:Msg" title="Client">Msg</a> -&gt; <a href="../base-4.11.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li class="src short"><a href="#v:handleMsg">handleMsg</a> :: <a href="../base-4.11.1.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; <a href="User.html#t:User" title="User">User</a> -&gt; <a href="Client.html#t:Msg" title="Client">Msg</a> -&gt; (<a href="User.html#t:User" title="User">User</a>, <a href="../base-4.11.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="Server.html#t:Event" title="Server">Event</a>)</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Event" class="def">Event</a> <a href="src/Server.html#Event" class="link">Source</a> <a href="#t:Event" class="selflink">#</a></p><div class="doc"><p>An event that should be handled by the main server</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:ClientMsg" class="def">ClientMsg</a> <a href="User.html#t:User" title="User">User</a> <a href="Client.html#t:Msg" title="Client">Msg</a></td><td class="doc"><p>A parsed message from a client</p></td></tr><tr><td class="src"><a id="v:NewUser" class="def">NewUser</a> <a href="User.html#t:User" title="User">User</a> <a href="../base-4.11.1.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a></td><td class="doc"><p>A new user can bea reached via the given handle</p></td></tr></table></div><div class="subs instances"><details id="i:Event" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Event:Eq:1"></span> <a href="../base-4.11.1.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> <a href="Server.html#t:Event" title="Server">Event</a></span> <a href="src/Server.html#line-40" class="link">Source</a> <a href="#t:Event" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Event:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Server.html">Server</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Server.html#t:Event" title="Server">Event</a> -&gt; <a href="Server.html#t:Event" title="Server">Event</a> -&gt; <a href="../base-4.11.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Server.html#t:Event" title="Server">Event</a> -&gt; <a href="Server.html#t:Event" title="Server">Event</a> -&gt; <a href="../base-4.11.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Event:Show:2"></span> <a href="../base-4.11.1.0/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Server.html#t:Event" title="Server">Event</a></span> <a href="src/Server.html#line-40" class="link">Source</a> <a href="#t:Event" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Event:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Server.html">Server</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.11.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Server.html#t:Event" title="Server">Event</a> -&gt; <a href="../base-4.11.1.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Server.html#t:Event" title="Server">Event</a> -&gt; <a href="../base-4.11.1.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Server.html#t:Event" title="Server">Event</a>] -&gt; <a href="../base-4.11.1.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:Users" class="def">Users</a> = <a href="../containers-0.5.11.0/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="../base-4.11.1.0/Data-String.html#t:String" title="Data.String">String</a> <a href="../base-4.11.1.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> <a href="src/Server.html#Users" class="link">Source</a> <a href="#t:Users" class="selflink">#</a></p><div class="doc"><p>This type maps from the nicknames to the handles to the client.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:Channels" class="def">Channels</a> = <a href="../containers-0.5.11.0/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="../base-4.11.1.0/Data-String.html#t:String" title="Data.String">String</a> [<a href="../base-4.11.1.0/Data-String.html#t:String" title="Data.String">String</a>] <a href="src/Server.html#Channels" class="link">Source</a> <a href="#t:Channels" class="selflink">#</a></p><div class="doc"><p>This type maps channel names to the nicknames of the users in the channel.</p></div></div><div class="top"><p class="src"><a id="v:startServer" class="def">startServer</a> <a href="src/Server.html#startServer" class="link">Source</a> <a href="#v:startServer" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: PortNumber</td><td class="doc"><p>The port that should accept new connections</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.11.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>This function sets up the listening socket, starts the main server, and starts
 a loop for accepting connections.</p></div></div><div class="top"><p class="src"><a id="v:acceptConnections" class="def">acceptConnections</a> <a href="src/Server.html#acceptConnections" class="link">Source</a> <a href="#v:acceptConnections" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: Socket</td><td class="doc"><p>The listening socket</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.11.1.0/Control-Concurrent-Chan.html#t:Chan" title="Control.Concurrent.Chan">Chan</a> <a href="Server.html#t:Event" title="Server">Event</a></td><td class="doc"><p>The channel to communicate with the main server</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.11.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>This function accepts new connections from clients and starts the communication
 with them in a new thread.</p></div></div><div class="top"><p class="src"><a id="v:mainServer" class="def">mainServer</a> <a href="src/Server.html#mainServer" class="link">Source</a> <a href="#v:mainServer" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.11.1.0/Control-Concurrent-Chan.html#t:Chan" title="Control.Concurrent.Chan">Chan</a> <a href="Server.html#t:Event" title="Server">Event</a></td><td class="doc"><p>The channels to receive events from the clients</p></td></tr><tr><td class="src">-&gt; <a href="Server.html#t:Users" title="Server">Users</a></td><td class="doc"><p>The currently connected users with their handles</p></td></tr><tr><td class="src">-&gt; <a href="Server.html#t:Channels" title="Server">Channels</a></td><td class="doc"><p>The currently available channels with their users</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.11.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>The main server waits for events that the clients generate. It also keeps track
 of the connected users and the channels. It modifies the states and sends replys
 to the clients.</p></div></div><div class="top"><p class="src"><a id="v:handleEvent" class="def">handleEvent</a> <a href="src/Server.html#handleEvent" class="link">Source</a> <a href="#v:handleEvent" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Server.html#t:Users" title="Server">Users</a></td><td class="doc"><p>The current users</p></td></tr><tr><td class="src">-&gt; <a href="Server.html#t:Channels" title="Server">Channels</a></td><td class="doc"><p>The current channel information</p></td></tr><tr><td class="src">-&gt; <a href="Server.html#t:Event" title="Server">Event</a></td><td class="doc"><p>The event received from the client</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.11.1.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Server.html#t:Users" title="Server">Users</a>, <a href="Server.html#t:Channels" title="Server">Channels</a>)</td><td class="doc"><p>It returns the new state of users and channels</p></td></tr></table></div><div class="doc"><p>This function contains the main logic of how to react to the different events.
 It processes the event, alters the users and the channel information where neccessary
 and sends responses to the clients.</p></div></div><div class="top"><p class="src"><a id="v:sendToUser" class="def">sendToUser</a> <a href="src/Server.html#sendToUser" class="link">Source</a> <a href="#v:sendToUser" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Server.html#t:Users" title="Server">Users</a></td><td class="doc"><p>The map of users to look up the correct handle</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.11.1.0/Data-String.html#t:String" title="Data.String">String</a></td><td class="doc"><p>The nickname of the user to send to</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.11.1.0/Data-String.html#t:String" title="Data.String">String</a></td><td class="doc"><p>The message to send</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.11.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>This function sends a message to a specified user.</p></div></div><div class="top"><p class="src"><a id="v:sendToAllUsers" class="def">sendToAllUsers</a> <a href="src/Server.html#sendToAllUsers" class="link">Source</a> <a href="#v:sendToAllUsers" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Server.html#t:Users" title="Server">Users</a></td><td class="doc"><p>The map of users to look up the correct handles</p></td></tr><tr><td class="src">-&gt; [<a href="../base-4.11.1.0/Data-String.html#t:String" title="Data.String">String</a>]</td><td class="doc"><p>The nicknames of the users to send to</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.11.1.0/Data-String.html#t:String" title="Data.String">String</a></td><td class="doc"><p>The message to send</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.11.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>This function sends the same message to many users.</p></div></div><div class="top"><p class="src"><a id="v:startConn" class="def">startConn</a> <a href="src/Server.html#startConn" class="link">Source</a> <a href="#v:startConn" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (Socket, SockAddr)</td><td class="doc"><p>The socket information for the client</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.11.1.0/Control-Concurrent-Chan.html#t:Chan" title="Control.Concurrent.Chan">Chan</a> <a href="Server.html#t:Event" title="Server">Event</a></td><td class="doc"><p>The channel to communictate with the main server</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.11.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>This function sets up the connection to a client and starts the loop that handles
 the further communication.</p></div></div><div class="top"><p class="src"><a id="v:loopConn" class="def">loopConn</a> <a href="src/Server.html#loopConn" class="link">Source</a> <a href="#v:loopConn" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.11.1.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a></td><td class="doc"><p>The handle to receive data from the client</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.11.1.0/Control-Concurrent-Chan.html#t:Chan" title="Control.Concurrent.Chan">Chan</a> <a href="Server.html#t:Event" title="Server">Event</a></td><td class="doc"><p>The channel to communicate with the main server</p></td></tr><tr><td class="src">-&gt; <a href="User.html#t:User" title="User">User</a></td><td class="doc"><p>The data of the user that is handled by this connection</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.11.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>This function handles the communication from the client to the server. It reads
 the messages, parses them, and acts accordingly.</p></div></div><div class="top"><p class="src"><a id="v:isFinalMsg" class="def">isFinalMsg</a> :: <a href="Client.html#t:Msg" title="Client">Msg</a> -&gt; <a href="../base-4.11.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="src/Server.html#isFinalMsg" class="link">Source</a> <a href="#v:isFinalMsg" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:handleMsg" class="def">handleMsg</a> :: <a href="../base-4.11.1.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; <a href="User.html#t:User" title="User">User</a> -&gt; <a href="Client.html#t:Msg" title="Client">Msg</a> -&gt; (<a href="User.html#t:User" title="User">User</a>, <a href="../base-4.11.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="Server.html#t:Event" title="Server">Event</a>) <a href="src/Server.html#handleMsg" class="link">Source</a> <a href="#v:handleMsg" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.20.0</p></div></body></html>